{{- /*
  Renders a menu for the given menu ID.

  @context {page} page The current page.
  @context {string} menuID The menu ID.

  @example: {{ partial "menu.html" (dict "menuID" "main" "page" .)
}}
*/}}
{{- $page := .page }}
{{- $menuID := .menuID }}

{{- with index site.Menus $menuID }}
  <nav class="side-bar">
    <ul class="side-bar__list">
      {{- partial "inline/menu/walk.html" (dict "page" $page "menuEntries" .) }}
    </ul>
  </nav>
{{- end }}

{{- define "_partials/inline/menu/walk.html" }}
  {{- $page := .page }}
  {{- $seperatorForFirstIcon := site.Params.navigationBar.seperatorForFirstIcon | default false }}
  {{- $iconsHaveLabels := site.Params.navigationBar.iconsHaveLabels | default false }}

  {{- range $i, $e := .menuEntries }}
    {{- $isFirst := and $seperatorForFirstIcon (eq $i 0) }}

    {{- $attrs := dict "href" $e.URL }}
    {{- if $.page.IsMenuCurrent $e.Menu $e }}
      {{- $attrs = merge $attrs (dict "class" "active" "aria-current" "page") }}
    {{- else if $.page.HasMenuCurrent $e.Menu $e }}
      {{- $attrs = merge $attrs (dict "class" "ancestor" "aria-current" "true") }}
    {{- end }}


    <li class="side-bar__item">
      <a
        {{- range $k, $v := $attrs }}
          {{- with $v }}{{ printf " %s=%q" $k $v | safeHTMLAttr }}{{- end }}
        {{- end -}}>
        {{- if $e.Pre }}
          <div
            class="side-bar__item-icon{{ if $isFirst }}
              side-bar__item-icon--first
            {{ end }}"
            title="Visit {{ $e.Name }}">
            {{ partial (printf "icons/%s.html" $e.Pre) $e }}
            {{- if $iconsHaveLabels }}
              <span class="side-bar__item-label">{{ $e.Name }}</span>
            {{- end -}}
          </div>
        {{- else }}
          <span class="side-bar__item-label">{{ $e.Name }}</span>
        {{- end -}}
      </a>

      {{- with $e.Children }}
        <ul>
          {{- partial "inline/menu/walk.html" (dict "page" $.page "menuEntries" .) }}
        </ul>
      {{- end }}
    </li>
  {{- end }}
{{- end }}
